# Copyright 2025 ETH Zurich and University of Bologna.
# Licensed under the Apache License, Version 2.0, see LICENSE for details.
# SPDX-License-Identifier: Apache-2.0

variables:
  VSIM: questa-2023.4 vsim
  BENDER: bender
  PYTHON: /usr/local/anaconda3/bin/python
  CHS_SW_GCC_BINROOT: /usr/pack/riscv-1.0-kgf/riscv64-gcc-12.2.0/bin
  LLVM_BINROOT: /usr/pack/riscv-1.0-kgf/pulp-llvm-0.12.0/bin

stages:
  - init
  - build
  - run

.bender-checkout:
  before_script:
    - $BENDER checkout

.install-py-deps:
  extends: .bender-checkout
  before_script:
    - $PYTHON -m venv .venv
    - source .venv/bin/activate
    - python -m pip install $(bender path floo_noc)
    - python -m pip install $(bender path snitch_cluster)
  cache:
    key:
      files:
        - Bender.lock
    paths:
      - .venv/

########################
# Build Software Tests #
########################

snrt-sw:
  stage: build
  extends:
    - .install-py-deps
  script:
    - make snrt-tests
  artifacts:
    paths:
      - sw/snitch/tests/build/*.elf
    expire_in: 1 day

chs-sw:
  stage: build
  extends:
    - .install-py-deps
  script:
    - make chs-sw-tests
  artifacts:
    paths:
      - sw/cheshire/tests/*.elf
    expire_in: 1 day
