# Copyright 2025 ETH Zurich and University of Bologna.
# Licensed under the Apache License, Version 2.0, see LICENSE for details.
# SPDX-License-Identifier: Apache-2.0

variables:
  VSIM: questa-2023.4 vsim
  BENDER: bender
  PYTHON: /usr/local/anaconda3/bin/python
  CHS_SW_GCC_BINROOT: /usr/pack/riscv-1.0-kgf/riscv64-gcc-12.2.0/bin

stages:
  - init
  - build
  - run

####################
# Pull bender deps #
####################

collect-bender-sources:
  stage: init
  script:
    - $BENDER checkout
  artifacts:
    paths:
      - .bender/

##############################
# Install python environment #
##############################

install-py-pkg:
  stage: init
  needs:
    - collect-bender-sources
  script:
    - $PYTHON -m venv .venv
    - source .venv/bin/activate
    - make floo-install-floogen
    - make sn-install-pkg
  artifacts:
    paths:
      - .venv/

########################
# Build Software Tests #
########################

snrt-sw:
  stage: build
  script:
    - source .venv/bin/activate
    - make snrt-tests
  artifacts:
    paths:
      - sw/snitch/tests/build/*.elf
    expire_in: 1 day

chs-sw:
  stage: build
  script:
    - source .venv/bin/activate
    - make chs-sw-tests
  artifacts:
    paths:
      - sw/cheshire/tests/*.elf
    expire_in: 1 day
